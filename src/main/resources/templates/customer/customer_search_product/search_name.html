<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kết quả tìm kiếm</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #0a4d68;
            --secondary-blue: #088395;
            --accent-teal: #05bfdb;
            --light-green: #8de0a6;
            --light-gray: #f8f9fa;
            --border-gray: #e9ecef;
            --text-gray: #6c757d;
            --text-dark: #343a40;
            --white: #ffffff;
            --success-green: #28a745;
            --warning-orange: #fd7e14;
            --shadow-sm: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            --shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 1rem 3rem rgba(0, 0, 0, 0.175);
            --border-radius: 0.75rem;
            --border-radius-sm: 0.5rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--light-green) 100%);
            min-height: 100vh;
            color: var(--text-dark);
            line-height: 1.6;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-gray);
            z-index: 1000;
            padding: 1rem 0;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: grid;
            grid-template-columns: 200px 1fr 200px;
            gap: 2rem;
            align-items: center;
        }

        .logo-container {
            display: inline-block;
            transition: transform 0.2s ease;
            justify-self: start;
        }

        .logo-container:hover {
            transform: translateY(-1px);
        }

        .logo-placeholder {
            width: 120px;
            height: 40px;
            background: var(--light-gray);
            border: 2px dashed var(--border-gray);
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-gray);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Enhanced Search Bar */
        .search-container {
            position: relative;
            max-width: 600px;
            width: 100%;
            justify-self: center;
        }

        .search-form {
            position: relative;
            display: flex;
            align-items: center;
            background: var(--white);
            border: 2px solid var(--accent-teal);
            border-radius: 50px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .search-form:focus-within {
            border-color: var(--secondary-blue);
            box-shadow: var(--shadow-lg);
            transform: translateY(-1px);
        }

        .search-input {
            flex: 1;
            border: none;
            outline: none;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-dark);
            background: transparent;
            font-family: inherit;
        }

        .search-input::placeholder {
            color: var(--text-gray);
            font-weight: 400;
        }

        .search-button {
            background: linear-gradient(135deg, var(--secondary-blue), var(--accent-teal));
            border: none;
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 50px;
        }

        .search-button:hover {
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            transform: scale(1.05);
        }

        .search-button:active {
            transform: scale(0.95);
        }

        .search-button svg {
            width: 18px;
            height: 18px;
            color: var(--white);
        }

        .clear-search {
            position: absolute;
            right: 60px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            border-radius: 50%;
            color: var(--text-gray);
            transition: all 0.2s ease;
            display: none;
        }

        .clear-search:hover {
            background: var(--light-gray);
            color: var(--text-dark);
        }

        .clear-search.show {
            display: block;
        }

        .clear-search svg {
            width: 16px;
            height: 16px;
        }

        .nav-links {
            display: flex;
            gap: 1.5rem;
            align-items: center;
            justify-self: end;
        }

        .nav-link {
            color: var(--primary-blue);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.875rem;
            padding: 0.5rem 1rem;
            border-radius: 1.25rem;
            transition: all 0.2s ease;
        }

        .nav-link:hover {
            background: var(--secondary-blue);
            color: var(--white);
        }

        /* Search Results Header */
        .search-results-header {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 1.5rem 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .search-results-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-teal), var(--light-green), var(--accent-teal));
        }

        .search-keyword {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .search-keyword svg {
            width: 1.5rem;
            height: 1.5rem;
            color: var(--accent-teal);
        }

        .search-keyword .keyword {
            background: linear-gradient(135deg, var(--accent-teal), var(--light-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 800;
        }

        .search-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .search-stats {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary-blue);
            display: block;
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 0.25rem;
        }

        .search-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .sort-dropdown {
            position: relative;
        }

        .sort-button {
            background: var(--light-gray);
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-sm);
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-dark);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sort-button:hover {
            border-color: var(--secondary-blue);
            background: var(--white);
        }

        .sort-button svg {
            width: 1rem;
            height: 1rem;
        }

        /* Main Content */
        .main-content {
            padding: 7rem 2rem 2rem;
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 2rem;
        }

        /* Professional Filter Sidebar */
        .filters-sidebar {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            height: fit-content;
            position: sticky;
            top: 7.5rem;
            overflow: hidden;
        }

        .filters-header {
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            color: var(--white);
            padding: 1.5rem;
            text-align: center;
        }

        .filters-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .filters-subtitle {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        .filters-content {
            padding: 1.5rem;
        }

        .filter-section {
            margin-bottom: 2rem;
        }

        .filter-section:last-child {
            margin-bottom: 0;
        }

        .filter-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--light-gray);
        }

        .filter-title svg {
            width: 1.125rem;
            height: 1.125rem;
            color: var(--secondary-blue);
        }

        /* Location Filter */
        .location-filter {
            position: relative;
        }

        .location-input-container {
            position: relative;
            margin-bottom: 1rem;
        }

        .location-input {
            width: 100%;
            padding: 0.75rem 2.5rem 0.75rem 0.75rem;
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-sm);
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
            background: var(--white);
            cursor: pointer;
        }

        .location-input:focus {
            outline: none;
            border-color: var(--secondary-blue);
            box-shadow: 0 0 0 3px rgba(8, 131, 149, 0.1);
        }

        .location-dropdown-arrow {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            width: 1rem;
            height: 1rem;
            color: var(--text-gray);
            transition: transform 0.2s ease;
            pointer-events: none;
        }

        .location-input-container.open .location-dropdown-arrow {
            transform: translateY(-50%) rotate(180deg);
        }

        .location-dropdown {
            position: absolute;
            top: calc(100% + 4px);
            left: 0;
            right: 0;
            background: var(--white);
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-sm);
            box-shadow: var(--shadow);
            max-height: 300px;
            overflow-y: auto;
            z-index: 1002;
            display: none;
        }

        .location-dropdown.show {
            display: block;
        }

        .location-search {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-gray);
            position: sticky;
            top: 0;
            background: var(--white);
            z-index: 1;
        }

        .location-search input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border-gray);
            border-radius: var(--border-radius-sm);
            font-size: 0.875rem;
        }

        .location-search input:focus {
            outline: none;
            border-color: var(--secondary-blue);
        }

        .location-option {
            padding: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .location-option:last-child {
            border-bottom: none;
        }

        .location-option:hover {
            background: var(--light-gray);
        }

        .location-option.selected {
            background: rgba(8, 131, 149, 0.1);
            color: var(--secondary-blue);
            font-weight: 600;
        }

        .location-option svg {
            width: 1rem;
            height: 1rem;
            color: var(--text-gray);
        }

        .location-option.selected svg {
            color: var(--secondary-blue);
        }

        /* Modern Price Filter */
        .price-filter {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .price-inputs-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .price-input-group {
            flex: 1;
            position: relative;
        }

        .price-input-label {
            display: block;
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-gray);
            margin-bottom: 0.25rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .price-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-sm);
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
            background: var(--white);
        }

        .price-input:focus {
            outline: none;
            border-color: var(--secondary-blue);
            box-shadow: 0 0 0 3px rgba(8, 131, 149, 0.1);
        }

        .price-separator {
            color: var(--text-gray);
            font-weight: 600;
            font-size: 1rem;
            margin-top: 1.25rem;
        }

        .price-presets {
            display: grid;
            gap: 0.5rem;
        }

        .price-preset {
            padding: 0.75rem 1rem;
            background: var(--light-gray);
            border: 2px solid transparent;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            text-align: center;
            transition: all 0.2s ease;
            color: var(--text-dark);
        }

        .price-preset:hover {
            background: var(--secondary-blue);
            color: var(--white);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .price-preset.active {
            background: var(--secondary-blue);
            color: var(--white);
            border-color: var(--secondary-blue);
            box-shadow: var(--shadow-sm);
        }

        /* Modern Rating Filter */
        .rating-filter {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .rating-option {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            background: var(--light-gray);
            border: 2px solid transparent;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .rating-option:hover {
            background: rgba(8, 131, 149, 0.1);
            border-color: var(--secondary-blue);
        }

        .rating-option.selected {
            background: rgba(8, 131, 149, 0.15);
            border-color: var(--secondary-blue);
            box-shadow: var(--shadow-sm);
        }

        .rating-radio {
            width: 1.125rem;
            height: 1.125rem;
            margin-right: 0.75rem;
            accent-color: var(--secondary-blue);
        }

        .rating-content {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
        }

        .rating-stars {
            display: flex;
            gap: 0.125rem;
        }

        .star {
            width: 1rem;
            height: 1rem;
            color: #ffc107;
        }

        .star.empty {
            color: var(--border-gray);
        }

        .rating-text {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-dark);
        }

        /* Filter Actions */
        .filter-actions {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            padding-top: 1.5rem;
            border-top: 2px solid var(--light-gray);
        }

        .btn {
            padding: 0.875rem 1.5rem;
            border: none;
            border-radius: var(--border-radius-sm);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--secondary-blue), var(--accent-teal));
            color: var(--white);
            box-shadow: var(--shadow-sm);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-gray);
            border: 2px solid var(--border-gray);
        }

        .btn-secondary:hover {
            background: var(--light-gray);
            border-color: var(--text-gray);
            color: var(--text-dark);
        }

        /* Products Section */
        .products-section {
            display: flex;
            flex-direction: column;
        }

        /* Products Grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .product-card {
            background: var(--white);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
            border: 1px solid var(--border-gray);
            cursor: pointer;
        }

        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
            border-color: var(--accent-teal);
        }

        .product-card.search-match {
            border-color: var(--accent-teal);
            box-shadow: 0 0 0 2px rgba(5, 191, 219, 0.2);
        }

        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .product-card:hover .product-image {
            transform: scale(1.05);
        }

        .product-info {
            padding: 1.25rem;
        }

        .product-name {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.75rem;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 2.5rem;
        }

        .product-price {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--secondary-blue);
            margin-bottom: 0.75rem;
        }

        .product-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .product-rating {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.75rem;
            color: var(--text-gray);
        }

        .product-rating .rating-stars {
            display: flex;
            gap: 0.125rem;
        }

        .product-rating .star {
            width: 0.875rem;
            height: 0.875rem;
            color: #ffc107;
        }

        .product-sold {
            font-size: 0.75rem;
            color: var(--text-gray);
            display: flex;
            align-items: center;
            gap: 0.25rem;
            margin-bottom: 0.75rem;
        }

        .sold-icon {
            width: 0.875rem;
            height: 0.875rem;
            color: var(--success-green);
        }

        .product-address {
            font-size: 0.75rem;
            color: var(--text-gray);
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .address-icon {
            width: 0.875rem;
            height: 0.875rem;
            color: var(--text-gray);
        }

        .no-image {
            width: 100%;
            height: 200px;
            background: var(--light-gray);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-gray);
            font-size: 0.75rem;
            gap: 0.5rem;
        }

        /* Search Highlight */
        .search-highlight {
            background: linear-gradient(135deg, var(--accent-teal), var(--light-green));
            color: var(--white);
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 600;
        }

        /* No Results */
        .no-results {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-gray);
        }

        .no-results-icon {
            width: 4rem;
            height: 4rem;
            margin: 0 auto 1rem;
            color: var(--border-gray);
        }

        .no-results h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .no-results p {
            font-size: 0.875rem;
            line-height: 1.6;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 4rem;
            color: var(--primary-blue);
        }

        .spinner {
            width: 2.5rem;
            height: 2.5rem;
            border: 3px solid var(--border-gray);
            border-top: 3px solid var(--secondary-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Pagination */
        .pagination-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin-top: 2rem;
            padding: 1.5rem 0;
        }

        .pagination-btn {
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-gray);
            background: var(--white);
            color: var(--text-dark);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.875rem;
            font-weight: 500;
            min-width: 2.75rem;
            text-align: center;
        }

        .pagination-btn:hover {
            background: var(--light-gray);
            border-color: var(--secondary-blue);
        }

        .pagination-btn.active {
            background: var(--secondary-blue);
            color: var(--white);
            border-color: var(--secondary-blue);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-info {
            margin: 0 1rem;
            font-size: 0.875rem;
            color: var(--text-dark);
            font-weight: 500;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .header-content {
                grid-template-columns: 180px 1fr 180px;
                gap: 1.5rem;
            }

            .main-content {
                grid-template-columns: 300px 1fr;
                gap: 1.5rem;
            }

            .products-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 280px 1fr;
            }

            .products-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .header-content {
                padding: 0 1rem;
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .search-container {
                order: 2;
                max-width: 100%;
            }

            .logo-container {
                order: 1;
                justify-self: center;
            }

            .nav-links {
                order: 3;
                justify-self: center;
            }

            .main-content {
                padding: 8rem 1rem 1rem;
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .filters-sidebar {
                position: static;
                order: 2;
            }

            .products-section {
                order: 1;
            }

            .products-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }

            .search-results-header {
                padding: 1.5rem;
            }

            .search-keyword {
                font-size: 1.25rem;
            }

            .search-meta {
                flex-direction: column;
                align-items: flex-start;
            }
        }

        @media (max-width: 480px) {
            .products-grid {
                grid-template-columns: 1fr;
            }

            .filters-content {
                padding: 1rem;
            }

            .filters-header {
                padding: 1rem;
            }

            .search-input {
                padding: 10px 16px;
                font-size: 13px;
            }

            .search-button {
                padding: 10px 16px;
                min-width: 45px;
            }
        }

        /* Focus states for accessibility */
        .search-input:focus,
        .clear-search:focus,
        .search-button:focus,
        .location-input:focus {
            outline: 2px solid var(--secondary-blue);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
<!-- Header -->
<header class="header">
    <div class="header-content">
        <!-- Logo -->
        <a href="/home" class="logo-container" aria-label="Về trang chủ">
            <div class="logo-placeholder">
                <span>Your Logo</span>
            </div>
        </a>

        <!-- Search Bar -->
        <div class="search-container">
            <div class="search-form">
                <input
                        type="text"
                        class="search-input"
                        id="searchInput"
                        placeholder="Tìm kiếm sản phẩm..."
                        autocomplete="off"
                        th:value="${searchKeyword}"
                />
                <button type="button" class="clear-search" id="clearSearch" aria-label="Xóa tìm kiếm">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                <button type="button" class="search-button" id="searchButton" aria-label="Tìm kiếm">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
                        <path d="m21 21-4.35-4.35" stroke="currentColor" stroke-width="2"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="nav-links">
            <a href="/home" class="nav-link">Trang chủ</a>
            <a href="/login" class="nav-link">Đăng nhập</a>
        </nav>
    </div>
</header>

<!-- Main Content -->
<main class="main-content">
    <!-- Professional Filter Sidebar -->
    <aside class="filters-sidebar">
        <div class="filters-header">
            <h2 class="filters-title">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 4.5H21V6H3V4.5Z" fill="currentColor"/>
                    <path d="M7.5 10.5H16.5V12H7.5V10.5Z" fill="currentColor"/>
                    <path d="M10.5 16.5H13.5V18H10.5V16.5Z" fill="currentColor"/>
                </svg>
                Bộ lọc sản phẩm
            </h2>
            <p class="filters-subtitle">Tìm sản phẩm phù hợp với bạn</p>
        </div>

        <div class="filters-content">
            <!-- Location Filter -->
            <div class="filter-section">
                <h3 class="filter-title">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M21 10C21 17L12 23L3 17C3 10 7.03 4 12 4S21 10 21 10Z" stroke="currentColor" stroke-width="2"/>
                        <circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    Khu vực
                </h3>
                <div class="location-filter">
                    <div class="location-input-container" id="locationContainer">
                        <input
                                type="text"
                                class="location-input"
                                id="locationInput"
                                placeholder="Chọn tỉnh thành"
                                readonly
                        />
                        <svg class="location-dropdown-arrow" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>

                        <div class="location-dropdown" id="locationDropdown">
                            <div class="location-search">
                                <input
                                        type="text"
                                        id="locationSearchInput"
                                        placeholder="Tìm kiếm tỉnh thành..."
                                />
                            </div>
                            <div id="locationOptions">
                                <!-- Location options will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Price Filter -->
            <div class="filter-section">
                <h3 class="filter-title">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 1V23M17 5H9.5C8.57174 5 7.6815 5.36875 7.02513 6.02513C6.36875 6.6815 6 7.57174 6 8.5C6 9.42826 6.36875 10.3185 7.02513 10.9749C7.6815 11.6312 8.57174 12 9.5 12H14.5C15.4283 12 16.3185 12.3687 16.9749 13.0251C17.6312 13.6815 18 14.5717 18 15.5C18 16.4283 17.6312 17.3185 16.9749 17.9749C16.3185 18.6312 15.4283 19 14.5 19H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Khoảng giá
                </h3>
                <div class="price-filter">
                    <div class="price-inputs-container">
                        <div class="price-input-group">
                            <label class="price-input-label">Từ</label>
                            <input type="number" class="price-input" id="minPrice" placeholder="0" min="0">
                        </div>
                        <span class="price-separator">—</span>
                        <div class="price-input-group">
                            <label class="price-input-label">Đến</label>
                            <input type="number" class="price-input" id="maxPrice" placeholder="Không giới hạn" min="0">
                        </div>
                    </div>
                    <div class="price-presets">
                        <div class="price-preset" data-min="0" data-max="100000">Dưới 100.000đ</div>
                        <div class="price-preset" data-min="100000" data-max="500000">100.000đ - 500.000đ</div>
                        <div class="price-preset" data-min="500000" data-max="1000000">500.000đ - 1.000.000đ</div>
                        <div class="price-preset" data-min="1000000" data-max="5000000">1.000.000đ - 5.000.000đ</div>
                        <div class="price-preset" data-min="5000000" data-max="">Trên 5.000.000đ</div>
                    </div>
                </div>
            </div>

            <!-- Rating Filter -->
            <div class="filter-section">
                <h3 class="filter-title">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z" fill="currentColor"/>
                    </svg>
                    Đánh giá sao
                </h3>
                <div class="rating-filter">
                    <label class="rating-option">
                        <input type="radio" name="rating" value="5" class="rating-radio">
                        <div class="rating-content">
                            <div class="rating-stars">
                                <svg class="star" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
                                </svg>
                                <svg class="star" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
                                </svg>
                                <svg class="star" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
                                </svg>
                                <svg class="star" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
                                </svg>
                                <svg class="star" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
                                </svg>
                            </div>
                            <span class="rating-text">5 sao</span>
                        </div>
                    </label>

                    <label class="rating-option">
                        <input type="radio" name="rating" value="4" class="rating-radio">
                        <div class="rating-content">
                            <div class="rating-stars">
                                <svg class="star" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
                                </svg>
                                <svg class="star" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
                                </svg>
                                <svg class="star" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
                                </svg>
                                <svg class="star" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
                                </svg>
                                <svg class="star empty" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
                                </svg>
                            </div>
                            <span class="rating-text">4 sao trở lên</span>
                        </div>
                    </label>

                    <label class="rating-option">
                        <input type="radio" name="rating" value="3" class="rating-radio">
                        <div class="rating-content">
                            <div class="rating-stars">
                                <svg class="star" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
                                </svg>
                                <svg class="star" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
                                </svg>
                                <svg class="star empty" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
                                </svg>
                                <svg class="star empty" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
                                </svg>
                            </div>
                            <span class="rating-text">3 sao trở lên</span>
                        </div>
                    </label>

                    <label class="rating-option">
                        <input type="radio" name="rating" value="all" class="rating-radio">
                        <div class="rating-content">
                            <div class="rating-stars">
                                <svg class="star empty" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
                                </svg>
                                <svg class="star empty" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
                                </svg>
                                <svg class="star empty" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
                                </svg>
                                <svg class="star empty" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
                                </svg>
                                <svg class="star empty" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
                                </svg>
                            </div>
                            <span class="rating-text">Tất cả đánh giá</span>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Filter Actions -->
            <div class="filter-actions">
                <button class="btn btn-primary" onclick="applyFilters()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Áp dụng bộ lọc
                </button>
                <button class="btn btn-secondary" onclick="clearFilters()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Xóa bộ lọc
                </button>
            </div>
        </div>
    </aside>

    <!-- Products Section -->
    <section class="products-section">
        <!-- Search Results Header -->
        <div class="search-results-header">
            <div class="search-keyword">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
                    <path d="m21 21-4.35-4.35" stroke="currentColor" stroke-width="2"/>
                </svg>
                Kết quả tìm kiếm cho: <span class="keyword" th:text="${searchKeyword}">từ khóa</span>
            </div>

            <div class="search-meta">
                <div class="search-stats">
                    <div class="stat-item">
                        <span class="stat-number" id="totalProducts" th:text="${#lists.size(products)}">0</span>
                        <span class="stat-label">Sản phẩm</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="currentPage">1</span>
                        <span class="stat-label">Trang hiện tại</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="totalPages">1</span>
                        <span class="stat-label">Tổng trang</span>
                    </div>
                </div>

                <div class="search-actions">
                    <div class="sort-dropdown">
                        <button class="sort-button" onclick="toggleSortDropdown()">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3 6H21M7 12H17M11 18H13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            Sắp xếp
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div class="loading" id="loadingState">
            <div class="spinner"></div>
            <p>Đang tải kết quả tìm kiếm...</p>
        </div>

        <!-- No Results -->
        <div class="no-results" id="noResults" style="display: none;">
            <svg class="no-results-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
                <path d="m21 21-4.35-4.35" stroke="currentColor" stroke-width="2"/>
                <path d="M16 16L8 8M8 16L16 8" stroke="currentColor" stroke-width="2"/>
            </svg>
            <h3>Không tìm thấy sản phẩm</h3>
            <p>Không có sản phẩm nào phù hợp với từ khóa tìm kiếm và bộ lọc của bạn.<br>Hãy thử tìm kiếm với từ khóa khác hoặc điều chỉnh bộ lọc.</p>
        </div>

        <!-- Products Grid -->
        <div class="products-grid" id="productsGrid" style="display: none;">
            <div class="product-card" th:each="product : ${products}"
                 th:data-product-id="${product.productId}"
                 th:data-price="${product.price}"
                 th:data-rating="${product.rate}"
                 th:data-location="${product.shopaddress}"
                 onclick="redirectToProductDetail(this.dataset.productId)">

                <div th:if="${product.imageUrl != null}">
                    <img th:src="@{${product.imageUrl}}" alt="Ảnh sản phẩm" class="product-image" />
                </div>
                <div th:if="${product.imageUrl == null}" class="no-image">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                        <circle cx="8.5" cy="8.5" r="1.5" stroke="currentColor" stroke-width="2"/>
                        <path d="M21 15L16 10L5 21" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <span>Không có ảnh</span>
                </div>

                <div class="product-info">
                    <h3 class="product-name" th:text="${product.name}">Tên sản phẩm</h3>
                    <div class="product-price" th:text="'₫' + ${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')}">₫0</div>

                    <div class="product-meta">
                        <div class="product-rating">
                            <div class="rating-stars">
                                <svg class="star" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
                                </svg>
                                <svg class="star" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
                                </svg>
                                <svg class="star" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
                                </svg>
                                <svg class="star" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
                                </svg>
                                <svg class="star" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
                                </svg>
                            </div>
                            <span th:text="'(' + ${product.rate} + ')'">0</span>
                        </div>
                    </div>

                    <div class="product-sold">
                        <svg class="sold-icon" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M8 1L10.09 5.26L15 6L11 9.74L11.91 14.5L8 12.27L4.09 14.5L5 9.74L1 6L5.91 5.26L8 1Z" fill="currentColor"/>
                        </svg>
                        <span th:text="'Đã bán ' + ${product.totalSold}">Đã bán 0</span>
                    </div>

                    <div class="product-address">
                        <svg class="address-icon" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M8 1C5.79086 1 4 2.79086 4 5C4 8.5 8 15 8 15C8 15 12 8.5 12 5C12 2.79086 10.2091 1 8 1Z" stroke="currentColor" stroke-width="2"/>
                            <circle cx="8" cy="5" r="1.5" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span th:text="${product.shopaddress}">Địa chỉ shop</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pagination -->
        <div class="pagination-container" id="paginationContainer" style="display: none;">
            <button class="pagination-btn" id="prevPageBtn" onclick="changePage(-1)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>

            <div id="pageNumbers"></div>

            <button class="pagination-btn" id="nextPageBtn" onclick="changePage(1)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>

            <div class="pagination-info" id="paginationInfo"></div>
        </div>
    </section>
</main>

<script>
    // Global variables
    let allProducts = [];
    let filteredProducts = [];
    let currentPage = 1;
    const productsPerPage = 30;
    let selectedLocation = '';
    let searchKeyword = '';

    // Vietnam provinces and cities
    const vietnamLocations = [
        'Tất cả khu vực',
        'An Giang', 'Bà Rịa - Vũng Tàu', 'Bắc Giang', 'Bắc Kạn', 'Bạc Liêu',
        'Bắc Ninh', 'Bến Tre', 'Bình Định', 'Bình Dương', 'Bình Phước',
        'Bình Thuận', 'Cà Mau', 'Cao Bằng', 'Đắk Lắk', 'Đắk Nông',
        'Điện Biên', 'Đồng Nai', 'Đồng Tháp', 'Gia Lai', 'Hà Giang',
        'Hà Nam', 'Hà Tĩnh', 'Hải Dương', 'Hậu Giang', 'Hòa Bình',
        'Hưng Yên', 'Khánh Hòa', 'Kiên Giang', 'Kon Tum', 'Lai Châu',
        'Lâm Đồng', 'Lạng Sơn', 'Lào Cai', 'Long An', 'Nam Định',
        'Nghệ An', 'Ninh Bình', 'Ninh Thuận', 'Phú Thọ', 'Phú Yên',
        'Quảng Bình', 'Quảng Nam', 'Quảng Ngãi', 'Quảng Ninh', 'Quảng Trị',
        'Sóc Trăng', 'Sơn La', 'Tây Ninh', 'Thái Bình', 'Thái Nguyên',
        'Thanh Hóa', 'Thừa Thiên Huế', 'Tiền Giang', 'Trà Vinh', 'Tuyên Quang',
        'Vĩnh Long', 'Vĩnh Phúc', 'Yên Bái',
        // Thành phố trực thuộc trung ương
        'Hà Nội', 'TP. Hồ Chí Minh', 'Đà Nẵng', 'Hải Phòng', 'Cần Thơ'
    ];

    // Product detail redirect function
    function redirectToProductDetail(productId) {
        window.location.href = `/detailproduct?id=${productId}`;
    }

    // Get search keyword from URL or Thymeleaf
    function getSearchKeyword() {
        const urlParams = new URLSearchParams(window.location.search);
        const keyword = urlParams.get('keyword');
        if (keyword) {
            searchKeyword = decodeURIComponent(keyword);
            document.getElementById('searchInput').value = searchKeyword;
            document.getElementById('clearSearch').classList.add('show');
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        // Get search keyword
        getSearchKeyword();

        // Initialize products after a short delay to show loading
        setTimeout(() => {
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('productsGrid').style.display = 'grid';

            initializeProducts();
            setupFilters();
            setupSearch();
            setupLocationFilter();
        }, 1000);
    });

    function initializeProducts() {
        const productCards = Array.from(document.querySelectorAll('.product-card'));

        if (productCards.length === 0) {
            document.getElementById('noResults').style.display = 'block';
            document.getElementById('productsGrid').style.display = 'none';
            return;
        }

        // Extract product data
        allProducts = productCards.map(card => {
            const name = card.querySelector('.product-name').textContent;
            const priceText = card.querySelector('.product-price').textContent;
            const price = parseInt(priceText.replace(/[^\d]/g, '')) || 0;
            const soldText = card.querySelector('.product-sold span').textContent;
            const totalSold = parseInt(soldText.replace(/[^\d]/g, '')) || 0;
            const imageElement = card.querySelector('.product-image');
            const imageUrl = imageElement ? imageElement.src : null;
            const productId = card.dataset.productId;
            const rating = parseFloat(card.dataset.rating) || 0;
            const location = card.dataset.location || '';

            return {
                id: productId,
                name,
                price,
                priceText,
                totalSold,
                imageUrl,
                rating,
                location,
                element: card,
                searchableText: name.toLowerCase(),
                searchableLocation: location.toLowerCase()
            };
        });

        filteredProducts = [...allProducts];

        // Highlight search keyword in product names
        if (searchKeyword) {
            highlightSearchKeyword();
        }

        // Initialize pagination and display
        initializePagination();
        displayProducts();
    }

    function highlightSearchKeyword() {
        allProducts.forEach(product => {
            const productNameElement = product.element.querySelector('.product-name');
            const originalText = product.name;
            const regex = new RegExp(`(${searchKeyword})`, 'gi');
            const highlightedText = originalText.replace(regex, '<span class="search-highlight">$1</span>');
            productNameElement.innerHTML = highlightedText;
        });
    }

    function setupLocationFilter() {
        const locationContainer = document.getElementById('locationContainer');
        const locationInput = document.getElementById('locationInput');
        const locationDropdown = document.getElementById('locationDropdown');
        const locationSearchInput = document.getElementById('locationSearchInput');
        const locationOptions = document.getElementById('locationOptions');

        // Populate location options
        populateLocationOptions(vietnamLocations);

        // Toggle dropdown
        locationContainer.addEventListener('click', function(e) {
            if (e.target === locationSearchInput) return;

            const isOpen = locationContainer.classList.contains('open');
            if (isOpen) {
                closeLocationDropdown();
            } else {
                openLocationDropdown();
            }
        });

        // Search in locations
        locationSearchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const filteredLocations = vietnamLocations.filter(location =>
                location.toLowerCase().includes(searchTerm)
            );
            populateLocationOptions(filteredLocations);
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!locationContainer.contains(e.target)) {
                closeLocationDropdown();
            }
        });

        function openLocationDropdown() {
            locationContainer.classList.add('open');
            locationDropdown.classList.add('show');
            locationSearchInput.focus();
        }

        function closeLocationDropdown() {
            locationContainer.classList.remove('open');
            locationDropdown.classList.remove('show');
            locationSearchInput.value = '';
            populateLocationOptions(vietnamLocations);
        }

        function populateLocationOptions(locations) {
            locationOptions.innerHTML = '';

            locations.forEach(location => {
                const option = document.createElement('div');
                option.className = 'location-option';
                if (location === selectedLocation) {
                    option.classList.add('selected');
                }

                option.innerHTML = `
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 10C21 17L12 23L3 17C3 10 7.03 4 12 4S21 10 21 10Z" stroke="currentColor" stroke-width="2"/>
                    <circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="2"/>
                </svg>
                ${location}
            `;

                option.addEventListener('click', function() {
                    selectLocation(location);
                    closeLocationDropdown();
                });

                locationOptions.appendChild(option);
            });
        }

        function selectLocation(location) {
            selectedLocation = location;
            locationInput.value = location;

            // Update selected state in options
            document.querySelectorAll('.location-option').forEach(opt => {
                opt.classList.remove('selected');
            });
        }
    }

    function setupSearch() {
        const searchInput = document.getElementById('searchInput');
        const clearSearch = document.getElementById('clearSearch');
        const searchButton = document.getElementById('searchButton');

        // Clear search
        clearSearch.addEventListener('click', function() {
            searchInput.value = '';
            clearSearch.classList.remove('show');
            // Redirect to search without keyword
            window.location.href = '/search_name';
        });

        // Search button click
        searchButton.addEventListener('click', function() {
            performNewSearch();
        });

        // Enter key support
        searchInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                performNewSearch();
            }
        });

        // Show/hide clear button
        searchInput.addEventListener('input', function() {
            if (this.value.trim()) {
                clearSearch.classList.add('show');
            } else {
                clearSearch.classList.remove('show');
            }
        });

        function performNewSearch() {
            const searchTerm = searchInput.value.trim();
            if (searchTerm) {
                // Redirect to search with new keyword
                window.location.href = `/search_name?keyword=${encodeURIComponent(searchTerm)}`;
            }
        }
    }

    function setupFilters() {
        // Price preset buttons
        const pricePresets = document.querySelectorAll('.price-preset');
        pricePresets.forEach(preset => {
            preset.addEventListener('click', function() {
                // Remove active class from all presets
                pricePresets.forEach(p => p.classList.remove('active'));
                // Add active class to clicked preset
                this.classList.add('active');

                // Set price inputs
                const minPrice = this.dataset.min;
                const maxPrice = this.dataset.max;

                document.getElementById('minPrice').value = minPrice;
                document.getElementById('maxPrice').value = maxPrice || '';
            });
        });

        // Clear active preset when typing in price inputs
        const priceInputs = document.querySelectorAll('.price-input');
        priceInputs.forEach(input => {
            input.addEventListener('input', function() {
                pricePresets.forEach(p => p.classList.remove('active'));
            });
        });

        // Rating radio buttons
        const ratingOptions = document.querySelectorAll('.rating-option');
        ratingOptions.forEach(option => {
            const radio = option.querySelector('input[type="radio"]');

            option.addEventListener('click', function(e) {
                if (e.target.type !== 'radio') {
                    radio.checked = true;
                    updateRatingSelection();
                }
            });

            radio.addEventListener('change', function() {
                updateRatingSelection();
            });
        });

        function updateRatingSelection() {
            ratingOptions.forEach(opt => opt.classList.remove('selected'));
            const checkedOption = document.querySelector('.rating-option input[type="radio"]:checked');
            if (checkedOption) {
                checkedOption.closest('.rating-option').classList.add('selected');
            }
        }
    }

    function applyFilters() {
        const minPrice = parseInt(document.getElementById('minPrice').value) || 0;
        const maxPrice = parseInt(document.getElementById('maxPrice').value) || Infinity;

        // Get selected rating
        const selectedRating = document.querySelector('input[name="rating"]:checked');
        const ratingValue = selectedRating ? selectedRating.value : 'all';

        // Filter products
        filteredProducts = allProducts.filter(product => {
            // Price filter
            const priceMatch = product.price >= minPrice && product.price <= maxPrice;

            // Rating filter
            let ratingMatch = true;
            if (ratingValue !== 'all') {
                const rating = parseInt(ratingValue);
                if (rating === 5) {
                    ratingMatch = product.rating >= 5;
                } else if (rating === 4) {
                    ratingMatch = product.rating >= 4;
                } else if (rating === 3) {
                    ratingMatch = product.rating >= 3;
                }
            }

            // Location filter
            let locationMatch = true;
            if (selectedLocation && selectedLocation !== 'Tất cả khu vực') {
                locationMatch = product.searchableLocation.includes(selectedLocation.toLowerCase());
            }

            return priceMatch && ratingMatch && locationMatch;
        });

        // Reset to first page
        currentPage = 1;

        // Update display
        initializePagination();
        displayProducts();

        // Update stats
        document.getElementById('totalProducts').textContent = filteredProducts.length;

        // Visual feedback
        const btn = event.target;
        btn.style.transform = 'scale(0.95)';
        setTimeout(() => {
            btn.style.transform = '';
        }, 150);
    }

    function clearFilters() {
        // Clear price inputs
        document.getElementById('minPrice').value = '';
        document.getElementById('maxPrice').value = '';

        // Clear rating selection
        const ratingRadios = document.querySelectorAll('input[name="rating"]');
        ratingRadios.forEach(radio => radio.checked = false);

        // Clear visual states
        document.querySelectorAll('.price-preset').forEach(preset => {
            preset.classList.remove('active');
        });
        document.querySelectorAll('.rating-option').forEach(option => {
            option.classList.remove('selected');
        });

        // Clear location
        document.getElementById('locationInput').value = '';
        selectedLocation = '';

        // Reset filtered products
        filteredProducts = [...allProducts];
        currentPage = 1;

        // Update display
        initializePagination();
        displayProducts();

        // Update stats
        document.getElementById('totalProducts').textContent = filteredProducts.length;

        // Visual feedback
        const btn = event.target;
        btn.style.transform = 'scale(0.95)';
        setTimeout(() => {
            btn.style.transform = '';
        }, 150);
    }

    function initializePagination() {
        const totalPages = Math.ceil(filteredProducts.length / productsPerPage);

        document.getElementById('totalPages').textContent = totalPages;

        if (totalPages > 1) {
            document.getElementById('paginationContainer').style.display = 'flex';
            updatePaginationControls(totalPages);
        } else {
            document.getElementById('paginationContainer').style.display = 'none';
        }
    }

    function displayProducts() {
        const startIndex = (currentPage - 1) * productsPerPage;
        const endIndex = startIndex + productsPerPage;
        const productsToShow = filteredProducts.slice(startIndex, endIndex);

        const productsGrid = document.getElementById('productsGrid');
        const noResults = document.getElementById('noResults');

        // Clear grid
        productsGrid.innerHTML = '';

        if (productsToShow.length === 0) {
            // Show no results
            productsGrid.style.display = 'none';
            noResults.style.display = 'block';
        } else {
            // Show products
            noResults.style.display = 'none';
            productsGrid.style.display = 'grid';

            productsToShow.forEach((product, index) => {
                const productCard = createProductCard(product);

                // Add search match styling
                productCard.classList.add('search-match');

                // Add entrance animation
                productCard.style.opacity = '0';
                productCard.style.transform = 'translateY(20px)';

                productsGrid.appendChild(productCard);

                // Staggered entrance animation
                setTimeout(() => {
                    productCard.style.transition = 'all 0.6s cubic-bezier(0.16, 1, 0.3, 1)';
                    productCard.style.opacity = '1';
                    productCard.style.transform = 'translateY(0)';
                }, (index % 5) * 100 + 100);
            });
        }

        // Update pagination info
        updatePaginationInfo();
        document.getElementById('currentPage').textContent = currentPage;
    }

    function generateStars(rating) {
        const fullStars = Math.floor(rating);
        let starsHtml = '';

        for (let i = 0; i < 5; i++) {
            const fillColor = i < fullStars ? 'currentColor' : '#e5e5e5';
            starsHtml += `
            <svg class="star" viewBox="0 0 24 24" fill="${fillColor}">
                <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
            </svg>
        `;
        }

        return starsHtml;
    }

    function createProductCard(product) {
        const card = document.createElement('div');
        card.className = 'product-card';
        card.dataset.productId = product.id;
        card.onclick = () => redirectToProductDetail(product.id);

        const imageHtml = product.imageUrl ?
            `<img src="${product.imageUrl}" alt="Ảnh sản phẩm" class="product-image" />` :
            `<div class="no-image">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                    <circle cx="8.5" cy="8.5" r="1.5" stroke="currentColor" stroke-width="2"/>
                    <path d="M21 15L16 10L5 21" stroke="currentColor" stroke-width="2"/>
                </svg>
                <span>Không có ảnh</span>
            </div>`;

        // Highlight search keyword in product name
        let displayName = product.name;
        if (searchKeyword) {
            const regex = new RegExp(`(${searchKeyword})`, 'gi');
            displayName = product.name.replace(regex, '<span class="search-highlight">$1</span>');
        }

        card.innerHTML = `
            ${imageHtml}
            <div class="product-info">
                <h3 class="product-name">${displayName}</h3>
                <div class="product-price">${product.priceText}</div>

                <div class="product-meta">
                    <div class="product-rating">
                        <div class="rating-stars">
                            ${generateStars(product.rating)}
                        </div>
                        <span>(${product.rating})</span>
                    </div>
                </div>

                <div class="product-sold">
                    <svg class="sold-icon" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 1L10.09 5.26L15 6L11 9.74L11.91 14.5L8 12.27L4.09 14.5L5 9.74L1 6L5.91 5.26L8 1Z" fill="currentColor"/>
                    </svg>
                    <span>Đã bán ${product.totalSold}</span>
                </div>

                <div class="product-address">
                    <svg class="address-icon" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 1C5.79086 1 4 2.79086 4 5C4 8.5 8 15 8 15C8 15 12 8.5 12 5C12 2.79086 10.2091 1 8 1Z" stroke="currentColor" stroke-width="2"/>
                        <circle cx="8" cy="5" r="1.5" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <span>${product.location}</span>
                </div>
            </div>
        `;

        return card;
    }

    function updatePaginationControls(totalPages) {
        const pageNumbers = document.getElementById('pageNumbers');
        pageNumbers.innerHTML = '';

        // Show page numbers
        for (let i = 1; i <= totalPages; i++) {
            if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `pagination-btn ${i === currentPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.onclick = () => goToPage(i);
                pageNumbers.appendChild(pageBtn);
            } else if (i === currentPage - 3 || i === currentPage + 3) {
                const ellipsis = document.createElement('span');
                ellipsis.textContent = '...';
                ellipsis.style.padding = '8px 4px';
                ellipsis.style.color = 'var(--text-dark)';
                pageNumbers.appendChild(ellipsis);
            }
        }

        // Update prev/next buttons
        document.getElementById('prevPageBtn').disabled = currentPage === 1;
        document.getElementById('nextPageBtn').disabled = currentPage === totalPages;
    }

    function updatePaginationInfo() {
        const startItem = (currentPage - 1) * productsPerPage + 1;
        const endItem = Math.min(currentPage * productsPerPage, filteredProducts.length);
        const totalItems = filteredProducts.length;

        document.getElementById('paginationInfo').textContent =
            `Hiển thị ${startItem}-${endItem} của ${totalItems} sản phẩm`;
    }

    function goToPage(page) {
        currentPage = page;
        displayProducts();
        updatePaginationControls(Math.ceil(filteredProducts.length / productsPerPage));

        // Scroll to top of products section
        document.querySelector('.products-section').scrollIntoView({
            behavior: 'smooth',
            block: 'start'
        });
    }

    function changePage(direction) {
        const totalPages = Math.ceil(filteredProducts.length / productsPerPage);
        const newPage = currentPage + direction;

        if (newPage >= 1 && newPage <= totalPages) {
            goToPage(newPage);
        }
    }

    function toggleSortDropdown() {
        // Placeholder for sort functionality
        console.log('Sort dropdown clicked');
    }
</script>
</body>
</html>