<meta charset="UTF-8">
<div id="products-page" class="page" th:fragment="products">
    <div class="page-header">
        <h2>Tất cả sản phẩm</h2>
        <div class="page-actions">
            <form th:action="@{/products}" method="get" class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" name="keyword" placeholder="Tìm kiếm sản phẩm..." th:value="${keyword}">
            </form>
            <a class="btn-primary" th:href="@{/products/create}">
                <i class="fas fa-plus"></i>
                Thêm sản phẩm
            </a>
        </div>
    </div>

    <div class="table-container">
        <table class="data-table">
            <thead>
            <tr>
                <th>Ảnh</th>
                <th>Tên sản phẩm</th>
                <th>Danh mục</th>
                <th>Giá</th>
                <th>Trạng thái</th>
                <th>Hành động</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="product : ${products}" th:id="'product-row-' + ${product.id}">
                <td>
                    <a href="#" th:onclick="'toggleVariants(' + ${product.id} + '); return false;'">
                        <i class="fas fa-caret-down"></i>
                        <img th:src="@{${product.getImages[0]?.imageurl}}" alt="Ảnh" style="width: 40px; height: 40px; object-fit: cover; margin-right: 8px;" />
                        <span th:text="${product.name}">Tên sản phẩm</span>
                    </a>
                </td>

                <td>
                    <a href="#" th:onclick="'toggleVariants(' + ${product.id} + '); return false;'">
                        <i class="fas fa-caret-down"></i>
                        <span th:text="${product.name}">Tên</span>
                    </a>
                </td>
                <td th:text="${product.categoryName}">Danh mục</td>
                <td th:text="${#numbers.formatDecimal(product.price, 1, 'COMMA', 2, 'POINT')}">0₫</td>
                <td th:text="${product.status}">Trạng thái</td>
                <td>
                    <a class="btn-icon" th:href="@{/products/edit/{id}(id=${product.id})}">
                        <i class="fas fa-edit"></i>
                    </a>
                    <form th:action="@{/products/delete/{id}(id=${product.id})}" method="post" style="display:inline;">
                        <input type="hidden" name="_method" value="delete" />
                        <button type="submit" class="btn-icon" onclick="return confirm('Bạn có chắc chắn muốn xóa sản phẩm này?');">
                            <i class="fas fa-trash"></i>
                        </button>
                    </form>
                </td>
            </tr>

            <!-- Biến thể -->
            <tr th:each="variant : ${product.inventoryList}" th:id="'variants-of-' + ${product.id}" class="variant-row" style="display:none;">
                <td colspan="5">
                    <div class="variant-item">
                        <strong>Màu:</strong> <span th:text="${variant.color}">Màu</span> |
                        <strong>Kích thước:</strong> <span th:text="${variant.dimension}">Kích thước</span> |
                        <strong>Số lượng:</strong> <span th:text="${variant.quantity}">0</span> |
                        <strong>Đã bán:</strong> <span th:text="${variant.solditems}">0</span>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    function toggleVariants(productId) {
        const variantRows = document.querySelectorAll('#variants-of-' + productId);
        variantRows.forEach(row => {
            row.style.display = row.style.display === 'none' ? '' : 'none';
        });
    }
</script>
